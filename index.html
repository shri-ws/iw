import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar } from 'recharts';
import { Calculator, TrendingUp, DollarSign, Calendar, Brain, PieChart } from 'lucide-react';

const InvestmentCalculator = () => {
  const [investmentType, setInvestmentType] = useState('lumpsum');
  const [principal, setPrincipal] = useState(100000);
  const [monthlyAmount, setMonthlyAmount] = useState(5000);
  const [interestRate, setInterestRate] = useState(12);
  const [timePeriod, setTimePeriod] = useState(10);
  const [results, setResults] = useState(null);
  const [chartData, setChartData] = useState([]);
  const [aiProjections, setAiProjections] = useState(null);

  const calculateInvestment = () => {
    let yearlyData = [];
    let totalAmount = 0;
    let totalInvested = 0;

    if (investmentType === 'lumpsum') {
      // Lump sum calculation
      totalInvested = principal;
      const monthlyRate = interestRate / 12 / 100;
      const months = timePeriod * 12;
      totalAmount = principal * Math.pow(1 + monthlyRate, months);
      
      // Generate yearly breakdown
      for (let year = 1; year <= timePeriod; year++) {
        const yearlyAmount = principal * Math.pow(1 + interestRate/100, year);
        yearlyData.push({
          year,
          amount: Math.round(yearlyAmount),
          invested: totalInvested,
          gains: Math.round(yearlyAmount - totalInvested)
        });
      }
    } else {
      // SIP calculation
      const monthlyRate = interestRate / 12 / 100;
      const months = timePeriod * 12;
      totalInvested = monthlyAmount * months;
      
      // SIP formula: M * [((1 + r)^n - 1) / r] * (1 + r)
      if (monthlyRate === 0) {
        totalAmount = monthlyAmount * months;
      } else {
        totalAmount = monthlyAmount * (((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate) * (1 + monthlyRate));
      }
      
      // Generate yearly breakdown for SIP
      let runningInvested = 0;
      let runningAmount = 0;
      
      for (let year = 1; year <= timePeriod; year++) {
        const monthsCompleted = year * 12;
        runningInvested = monthlyAmount * monthsCompleted;
        
        if (monthlyRate === 0) {
          runningAmount = runningInvested;
        } else {
          runningAmount = monthlyAmount * (((Math.pow(1 + monthlyRate, monthsCompleted) - 1) / monthlyRate) * (1 + monthlyRate));
        }
        
        yearlyData.push({
          year,
          amount: Math.round(runningAmount),
          invested: runningInvested,
          gains: Math.round(runningAmount - runningInvested)
        });
      }
    }

    const gains = totalAmount - totalInvested;
    
    setResults({
      totalAmount: Math.round(totalAmount),
      totalInvested: Math.round(totalInvested),
      totalGains: Math.round(gains),
      roi: ((gains / totalInvested) * 100).toFixed(2)
    });
    
    setChartData(yearlyData);
    generateAIProjections(totalAmount, gains, totalInvested);
  };

  const generateAIProjections = (amount, gains, invested) => {
    // Simulate AI analysis with realistic financial projections
    const currentROI = (gains / invested) * 100;
    const annualROI = currentROI / timePeriod;
    
    const projections = {
      riskAssessment: getRiskLevel(interestRate),
      optimisticScenario: Math.round(amount * 1.25),
      pessimisticScenario: Math.round(amount * 0.85),
      inflationAdjusted: Math.round(amount / Math.pow(1.06, timePeriod)), // 6% inflation
      recommendations: getRecommendations(interestRate, investmentType, timePeriod),
      marketTrends: getMarketTrends(interestRate)
    };
    
    setAiProjections(projections);
  };

  const getRiskLevel = (rate) => {
    if (rate <= 6) return { level: 'Low', color: 'text-green-600', description: 'Conservative investment with stable returns' };
    if (rate <= 12) return { level: 'Medium', color: 'text-yellow-600', description: 'Balanced risk-reward ratio' };
    return { level: 'High', color: 'text-red-600', description: 'Aggressive growth potential with higher volatility' };
  };

  const getRecommendations = (rate, type, period) => {
    const recs = [];
    if (type === 'sip' && period < 5) {
      recs.push('Consider extending investment period for better compounding benefits');
    }
    if (rate > 15) {
      recs.push('High return expectations - ensure proper diversification');
    }
    if (rate < 8) {
      recs.push('Consider equity exposure for inflation-beating returns');
    }
    return recs.length > 0 ? recs : ['Your investment strategy looks well-balanced'];
  };

  const getMarketTrends = (rate) => {
    if (rate <= 8) return 'Suitable for debt instruments and fixed deposits';
    if (rate <= 12) return 'Ideal for balanced mutual funds and hybrid investments';
    return 'Aligned with equity market expectations and growth funds';
  };

  useEffect(() => {
    calculateInvestment();
  }, [investmentType, principal, monthlyAmount, interestRate, timePeriod]);

  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    }).format(amount);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Calculator className="w-10 h-10 text-indigo-600" />
            <h1 className="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
              Smart Investment Calculator
            </h1>
          </div>
          <p className="text-gray-600 text-lg">Plan your financial future with AI-powered insights</p>
        </div>

        <div className="grid lg:grid-cols-3 gap-8">
          {/* Input Panel */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
              <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <DollarSign className="w-6 h-6 text-indigo-600" />
                Investment Details
              </h2>

              {/* Investment Type */}
              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-3">Investment Type</label>
                <div className="grid grid-cols-2 gap-3">
                  <button
                    onClick={() => setInvestmentType('lumpsum')}
                    className={`p-3 rounded-xl font-medium transition-all ${
                      investmentType === 'lumpsum'
                        ? 'bg-indigo-600 text-white shadow-lg'
                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                    }`}
                  >
                    Lump Sum
                  </button>
                  <button
                    onClick={() => setInvestmentType('sip')}
                    className={`p-3 rounded-xl font-medium transition-all ${
                      investmentType === 'sip'
                        ? 'bg-indigo-600 text-white shadow-lg'
                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                    }`}
                  >
                    SIP
                  </button>
                </div>
              </div>

              {/* Investment Amount */}
              {investmentType === 'lumpsum' ? (
                <div className="mb-6">
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    Initial Investment
                  </label>
                  <input
                    type="number"
                    value={principal}
                    onChange={(e) => setPrincipal(Number(e.target.value))}
                    className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder="Enter amount"
                  />
                </div>
              ) : (
                <div className="mb-6">
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    Monthly Investment
                  </label>
                  <input
                    type="number"
                    value={monthlyAmount}
                    onChange={(e) => setMonthlyAmount(Number(e.target.value))}
                    className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder="Enter monthly amount"
                  />
                </div>
              )}

              {/* Interest Rate */}
              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Expected Annual Return (%)
                </label>
                <input
                  type="number"
                  step="0.1"
                  value={interestRate}
                  onChange={(e) => setInterestRate(Number(e.target.value))}
                  className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                  placeholder="Enter interest rate"
                />
                <div className="mt-2 text-xs text-gray-500">
                  Typical ranges: FD (6-8%), Mutual Funds (10-15%), Equity (12-18%)
                </div>
              </div>

              {/* Time Period */}
              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Investment Period (Years)
                </label>
                <input
                  type="number"
                  value={timePeriod}
                  onChange={(e) => setTimePeriod(Number(e.target.value))}
                  className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                  placeholder="Enter years"
                />
              </div>
            </div>
          </div>

          {/* Results Panel */}
          <div className="lg:col-span-2 space-y-8">
            {results && (
              <>
                {/* Summary Cards */}
                <div className="grid md:grid-cols-3 gap-6">
                  <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                    <div className="flex items-center gap-3 mb-3">
                      <TrendingUp className="w-8 h-8 text-green-600" />
                      <h3 className="text-lg font-bold text-gray-800">Total Value</h3>
                    </div>
                    <p className="text-3xl font-bold text-green-600">{formatCurrency(results.totalAmount)}</p>
                  </div>
                  
                  <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                    <div className="flex items-center gap-3 mb-3">
                      <DollarSign className="w-8 h-8 text-blue-600" />
                      <h3 className="text-lg font-bold text-gray-800">Total Invested</h3>
                    </div>
                    <p className="text-3xl font-bold text-blue-600">{formatCurrency(results.totalInvested)}</p>
                  </div>
                  
                  <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                    <div className="flex items-center gap-3 mb-3">
                      <PieChart className="w-8 h-8 text-purple-600" />
                      <h3 className="text-lg font-bold text-gray-800">Total Gains</h3>
                    </div>
                    <p className="text-3xl font-bold text-purple-600">{formatCurrency(results.totalGains)}</p>
                    <p className="text-sm text-gray-600 mt-1">ROI: {results.roi}%</p>
                  </div>
                </div>

                {/* Growth Chart */}
                <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">Investment Growth Over Time</h3>
                  <ResponsiveContainer width="100%" height={300}>
                    <LineChart data={chartData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                      <XAxis dataKey="year" stroke="#666" />
                      <YAxis 
                        stroke="#666"
                        tickFormatter={(value) => `â‚¹${(value/100000).toFixed(1)}L`}
                      />
                      <Tooltip 
                        formatter={(value, name) => [formatCurrency(value), name]}
                        labelFormatter={(label) => `Year ${label}`}
                      />
                      <Line 
                        type="monotone" 
                        dataKey="amount" 
                        stroke="#8b5cf6" 
                        strokeWidth={3}
                        name="Total Value"
                      />
                      <Line 
                        type="monotone" 
                        dataKey="invested" 
                        stroke="#3b82f6" 
                        strokeWidth={2}
                        name="Amount Invested"
                      />
                      <Line 
                        type="monotone" 
                        dataKey="gains" 
                        stroke="#10b981" 
                        strokeWidth={2}
                        name="Gains"
                      />
                    </LineChart>
                  </ResponsiveContainer>
                </div>

                {/* AI Projections */}
                {aiProjections && (
                  <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                    <div className="flex items-center gap-3 mb-6">
                      <Brain className="w-8 h-8 text-purple-600" />
                      <h3 className="text-xl font-bold text-gray-800">AI-Powered Analysis</h3>
                    </div>
                    
                    <div className="grid md:grid-cols-2 gap-6">
                      {/* Risk Assessment */}
                      <div className="p-4 bg-gray-50 rounded-xl">
                        <h4 className="font-bold text-gray-800 mb-2">Risk Assessment</h4>
                        <p className={`text-lg font-semibold ${aiProjections.riskAssessment.color}`}>
                          {aiProjections.riskAssessment.level} Risk
                        </p>
                        <p className="text-sm text-gray-600">{aiProjections.riskAssessment.description}</p>
                      </div>

                      {/* Market Trends */}
                      <div className="p-4 bg-gray-50 rounded-xl">
                        <h4 className="font-bold text-gray-800 mb-2">Market Alignment</h4>
                        <p className="text-sm text-gray-700">{aiProjections.marketTrends}</p>
                      </div>
                    </div>

                    {/* Scenario Analysis */}
                    <div className="mt-6">
                      <h4 className="font-bold text-gray-800 mb-4">Scenario Analysis</h4>
                      <div className="grid md:grid-cols-3 gap-4">
                        <div className="p-4 bg-green-50 rounded-xl border border-green-200">
                          <h5 className="font-semibold text-green-800">Optimistic</h5>
                          <p className="text-2xl font-bold text-green-600">
                            {formatCurrency(aiProjections.optimisticScenario)}
                          </p>
                          <p className="text-xs text-green-600">25% above expected</p>
                        </div>
                        
                        <div className="p-4 bg-blue-50 rounded-xl border border-blue-200">
                          <h5 className="font-semibold text-blue-800">Inflation Adjusted</h5>
                          <p className="text-2xl font-bold text-blue-600">
                            {formatCurrency(aiProjections.inflationAdjusted)}
                          </p>
                          <p className="text-xs text-blue-600">Real purchasing power</p>
                        </div>
                        
                        <div className="p-4 bg-red-50 rounded-xl border border-red-200">
                          <h5 className="font-semibold text-red-800">Conservative</h5>
                          <p className="text-2xl font-bold text-red-600">
                            {formatCurrency(aiProjections.pessimisticScenario)}
                          </p>
                          <p className="text-xs text-red-600">15% below expected</p>
                        </div>
                      </div>
                    </div>

                    {/* Recommendations */}
                    <div className="mt-6 p-4 bg-indigo-50 rounded-xl border border-indigo-200">
                      <h4 className="font-bold text-indigo-800 mb-3">AI Recommendations</h4>
                      <ul className="space-y-2">
                        {aiProjections.recommendations.map((rec, index) => (
                          <li key={index} className="text-sm text-indigo-700 flex items-start gap-2">
                            <span className="w-1.5 h-1.5 bg-indigo-400 rounded-full mt-2 flex-shrink-0"></span>
                            {rec}
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>
                )}
              </>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default InvestmentCalculator;
